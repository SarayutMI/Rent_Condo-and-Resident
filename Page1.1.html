<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>รายละเอียดคอนโด - กรุงเทพฯ</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/lightbox2@2.11.3/dist/css/lightbox.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        font-family: "Sarabun", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding-top: 80px;
        padding-bottom: 50px;
      }

      .navbar {
        background: rgba(255, 255, 255, 0.95) !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .detail-container {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        margin-top: 30px;
      }

      .main-image {
        width: 100%;
        height: 800px;
        object-fit: cover;
        border-radius: 15px;
        margin-bottom: 30px;
      }

      .gallery-image {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .gallery-image:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }
      #galleryCarousel .carousel-item img {
        height: 400px;
        object-fit: cover;
        border-radius: 15px;
      }

      .condo-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 20px;
      }

      .price-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
      }

      .price-amount {
        font-size: 2.5rem;
        font-weight: 700;
      }

      .info-section {
        margin: 30px 0;
      }

      .info-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #667eea;
        margin-bottom: 15px;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .info-item {
        padding: 15px 0;
        border-bottom: 1px solid #eee;
      }

      .info-item:last-child {
        border-bottom: none;
      }

      .info-label {
        font-weight: 600;
        color: #555;
        width: 180px;
        display: inline-block;
      }

      .info-value {
        color: #333;
      }

      .feature-box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
      }

      .feature-box:hover {
        background: #e9ecef;
        transform: translateX(5px);
      }

      .feature-icon {
        font-size: 2rem;
        color: #667eea;
        margin-right: 15px;
      }

      .btn-contact {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      .btn-contact:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        color: white;
      }

      .btn-back {
        background: #6c757d;
        color: white;
        border: none;
        padding: 10px 25px;
        border-radius: 20px;
        transition: all 0.3s ease;
      }

      .btn-back:hover {
        background: #5a6268;
        color: white;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
      <div class="container">
        <a class="navbar-brand" href="index.html">
          <i class="fas fa-building"></i> K&J CondotelRent
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="./index.html">หน้าแรก</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="./Page1.html">กรุงเทพฯ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./Page2.html">พัทยา</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./Page3.html">ชะอำ-ปึกเตียน</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./Page7.html">ดาวน์โหลด</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./Page8.html">ติดต่อเรา</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Detail Content -->
    <div class="container">
      <div class="detail-container" data-aos="fade-up">
        <a href="./Page1.html" class="btn btn-back mb-4">
          <i class="fas fa-arrow-left"></i> กลับหน้ารายการ
        </a>

        <h1 class="condo-title" id="condoTitle">The Prime Sukhumvit</h1>

        <!-- Main Image -->
        <img src="" class="main-image" id="mainImage" alt="คอนโด" />

        <!-- Gallery Carousel -->
        <div
          id="galleryCarousel"
          class="carousel slide mb-4"
          data-bs-ride="carousel"
        >
          <div class="carousel-inner" id="galleryCarouselInner">
            <!-- Images will be injected here by JS -->
          </div>
          <button
            class="carousel-control-prev"
            type="button"
            data-bs-target="#galleryCarousel"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next"
            type="button"
            data-bs-target="#galleryCarousel"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
        <!-- Gallery Carousel Note: หากใน CSV มี path ของโฟลเดอร์ภาพ ให้เตรียม JS สำหรับอ่านไฟล์ภาพในโฟลเดอร์นั้นและแสดงใน carousel นี้ -->
        <div id="galleryRow" class="row mb-4"></div>

        <script>
          function renderGalleryCarouselFromFolder(folderPath) {
            let idx = 1;
            let images = [];
            function checkNext() {
              let url = `${folderPath}/image${idx}.jpg`;
              let img = new Image();
              img.onload = function () {
                images.push(url);
                idx++;
                checkNext();
              };
              img.onerror = function () {
                // เมื่อเจอไฟล์ที่ไม่มีแล้ว ให้แสดงผลลัพธ์
                if (images.length === 0) {
                  $("#galleryCarousel").hide();
                  return;
                }
                let carouselInnerHtml = "";
                images.forEach((imgUrl, i) => {
                  carouselInnerHtml += `
                                    <div class="carousel-item${i === 0 ? " active" : ""}">
                                        <a href="${imgUrl}" data-lightbox="gallery">
                                            <img src="${imgUrl}" class="d-block w-100 main-image" alt="Gallery Image ${i + 1}">
                                        </a>
                                    </div>
                                `;
                });
                $("#galleryCarouselInner").html(carouselInnerHtml);
                $("#galleryCarousel").show();
              };
              img.src = url;
            }
            checkNext();
          }
        </script>
        <!-- Price Section -->
        <div class="price-section text-center">
          <div class="price-label">ราคาพิเศษ</div>
          <div class="price-amount" id="condoPrice"></div>
          <p class="mb-0" id="condoPriceNote"></p>
        </div>

        <div class="row">
          <div class="col-lg-8">
            <!-- Basic Info -->
            <div class="info-section">
              <h2 class="info-title">
                <i class="fas fa-info-circle"></i> ข้อมูลทั่วไป
              </h2>
              <div class="info-item">
                <span class="info-label"
                  ><i class="fas fa-map-marker-alt"></i> ทำเล:</span
                >
                <span class="info-value" id="location"></span>
              </div>
              <div class="info-item">
                <span class="info-label"
                  ><i class="fas fa-bed"></i> ห้องนอน:</span
                >
                <span class="info-value" id="bedroom"></span>
              </div>
              <div class="info-item">
                <span class="info-label"
                  ><i class="fas fa-bath"></i> ห้องน้ำ:</span
                >
                <span class="info-value" id="bathroom"></span>
              </div>
              <div class="info-item">
                <span class="info-label"
                  ><i class="fas fa-ruler-combined"></i> ขนาด:</span
                >
                <span class="info-value" id="size"></span>
              </div>
              <div class="info-item">
                <span class="info-label"
                  ><i class="fas fa-building"></i> ชั้น:</span
                >
                <span class="info-value" id="floor"></span>
              </div>
              <div class="info-item">
                <span class="info-label"
                  ><i class="fas fa-compass"></i> ทิศ:</span
                >
                <span class="info-value" id="direction"></span>
              </div>
            </div>

            <!-- Description -->
            <div class="info-section">
              <h2 class="info-title">
                <i class="fas fa-align-left"></i> รายละเอียด
              </h2>
              <div id="condoDescription"></div>
            </div>
          </div>

          <div class="col-lg-4">
            <!-- Facilities -->
            <div class="info-section">
              <h2 class="info-title">
                <i class="fas fa-star"></i> สิ่งอำนวยความสะดวก
              </h2>
              <div id="facilitiesList"></div>
            </div>

            <!-- Contact -->
            <div class="info-section">
              <h2 class="info-title">
                <i class="fas fa-phone"></i> ติดต่อสอบถาม
              </h2>
              <div class="text-center">
                <a href="./Page8.html" class="btn btn-contact w-100 mb-3">
                  <i class="fas fa-envelope"></i> ส่งข้อความ
                </a>
                <a
                  href="tel:02-xxx-xxxx"
                  class="btn btn-contact w-100"
                  id="condoPhone"
                >
                  <i class="fas fa-phone"></i> โทร 02-XXX-XXXX
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lightbox2@2.11.3/dist/js/lightbox.min.js"></script>
    <script>
      AOS.init({
        duration: 1000,
        once: true,
      });

      // ฟังก์ชันแปลง CSV เป็น Array of Object (รองรับกรณีมี comma ใน field ด้วย)
      function csvToArray(str, delimiter = ",") {
        const pattern = new RegExp(
          "(\\" +
            delimiter +
            "|\\r?\\n|\\r|^)" +
            '(?:"([^"]*(?:""[^"]*)*)"|' +
            '([^"\\' +
            delimiter +
            "\\r\\n]*))",
          "gi",
        );
        let headers = [];
        let data = [[]];
        let matches = null;
        let isHeader = true;
        while ((matches = pattern.exec(str))) {
          let matchedDelimiter = matches[1];
          if (matchedDelimiter.length && matchedDelimiter !== delimiter) {
            data.push([]);
          }
          let value = matches[2] ? matches[2].replace(/""/g, '"') : matches[3];
          data[data.length - 1].push(value);
        }
        headers = data.shift();
        return data
          .filter((row) => row.length === headers.length)
          .map((row) => {
            return headers.reduce((obj, header, i) => {
              obj[header.trim()] = row[i] ? row[i].trim() : "";
              return obj;
            }, {});
          });
      }

      // ฟังก์ชันแปลงสิ่งอำนวยความสะดวกเป็น HTML
      function renderFacilities(facilitiesStr) {
        if (!facilitiesStr) return "";
        // สมมติว่าใน CSV แยกด้วย | เช่น "สระว่ายน้ำ|ฟิตเนส|ที่จอดรถ"
        const iconMap = {
          สระว่ายน้ำ: "fa-swimming-pool",
          ฟิตเนส: "fa-dumbbell",
          "รักษาความปลอดภัย 24 ชม.": "fa-shield-alt",
          ที่จอดรถ: "fa-car",
          "Key Card": "fa-key",
          CCTV: "fa-video",
          เครื่องปรับอากาศ: "fa-wind",
          โทรทัศน์: "fa-tv",
          "Wi-Fi": "fa-wifi",
          ตู้เย็น: "fa-snowflake",
          กาต้มน้ำไฟฟ้า: "fa-mug-hot",
          ตู้นิรภัย: "fa-lock",
          ไดร์เป่าผม: "fa-fan",
          โต๊ะทำงาน: "fa-chair",
          ระเบียง: "fa-umbrella-beach",
          ลิฟต์: "fa-elevator",
          // เพิ่มเติมได้ตามต้องการ
        };
        return facilitiesStr
          .split("|")
          .map((fac) => {
            const icon = iconMap[fac.trim()] || "fa-star";
            return `<div class="feature-box">
                        <i class="fas ${icon} feature-icon"></i>
                        <strong>${fac.trim()}</strong>
                    </div>`;
          })
          .join("");
      }

      // ฟังก์ชันแปลงรายละเอียดเป็น HTML (รองรับหลายบรรทัด)
      function renderDescription(descStr) {
        if (!descStr) return "";
        // สมมติว่าใน CSV แยกแต่ละย่อหน้าด้วย \n หรือ |
        if (descStr.includes("|")) {
          return descStr
            .split("|")
            .map((line) => `<p>${line.trim()}</p>`)
            .join("");
        }
        return `<p>${descStr.replace(/\n/g, "</p><p>")}</p>`;
      }

      // ฟังก์ชันแปลง gallery เป็น HTML
      function renderGallery(galleryStr) {
        if (!galleryStr) return "";
        // สมมติว่าใน CSV แยกแต่ละรูปด้วย | และแต่ละรูปเป็น url หรือ url,alt
        const images = galleryStr.split("|").map((item) => {
          const [url, alt] = item.split(",");
          return `<div class="col-md-3 col-6">
                        <a href="${url.trim()}" data-lightbox="gallery">
                            <img src="${url.trim()}" class="gallery-image" alt="${alt ? alt.trim() : ""}">
                        </a>
                    </div>`;
        });
        return images.join("");
      }

      // โหลดข้อมูลจาก condo.csv
      $(function () {
        const urlParams = new URLSearchParams(window.location.search);
        const condoId = urlParams.get("id");

        $.get("./Bangkok/condos-bangkok.csv", function (data) {
          const condos = csvToArray(data);
          const condo = condos.find((c) => c.id === condoId);
          if (condo) {
            $("#condoTitle").text(condo.title);
            $("#condoPrice").text(condo.price);
            $("#condoPriceNote").text(
              condo.price_note || "*ราคารวมค่าโอน ค่าจดจำนอง",
            );
            $("#location").text(condo.location);
            $("#bedroom").text(condo.bedroom);
            $("#bathroom").text(condo.bathroom);
            $("#size").text(condo.size);
            $("#floor").text(condo.floor);
            $("#direction").text(condo.direction);
            $("#mainImage").attr("src", condo.image);

            // Description
            $("#condoDescription").html(renderDescription(condo.description));

            // Facilities
            $("#facilitiesList").html(renderFacilities(condo.facilities));

            // Gallery
            if (condo.gallery) {
              // If the gallery field looks like a folder path (does not contain '|' and does not look like a URL)
              if (
                !condo.gallery.includes("|") &&
                !condo.gallery.match(/^https?:\/\//)
              ) {
                // Show carousel from folder
                $("#galleryRow").empty();
                renderGalleryCarouselFromFolder(condo.gallery);
              } else {
                // Show carousel, hide grid
                $("#galleryCarousel").show();
                $("#galleryRow").empty();
                // Render carousel slides
                const images = condo.gallery.split("|").map((item) => {
                  const [url, alt] = item.split(",");
                  return {
                    url: url.trim(),
                    alt: alt ? alt.trim() : "",
                  };
                });
                let carouselInnerHtml = "";
                images.forEach((img, idx) => {
                  carouselInnerHtml += `
                                <div class="carousel-item${idx === 0 ? " active" : ""}">
                                    <a href="${img.url}" data-lightbox="gallery">
                                        <img src="${img.url}" class="d-block w-100 main-image" alt="${img.alt}">
                                    </a>
                                </div>
                            `;
                });
                $("#galleryCarouselInner").html(carouselInnerHtml);
              }
            } else {
              $("#galleryCarousel").hide();
              $("#galleryRow").empty();
            }

            // Set phone number
            if (condo.phone) {
              $("#condoPhone").html(
                `<i class="fas fa-phone"></i> โทร ${condo.phone}`,
              );
              $("#condoPhone").attr(
                "href",
                `tel:${condo.phone.replace(/[^0-9]/g, "")}`,
              );
            }
          }
        });
      });
    </script>
  </body>
</html>
